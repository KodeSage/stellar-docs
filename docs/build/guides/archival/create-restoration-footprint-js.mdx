---
title: Create a restoration footprint manually to restore archived data using the JavaScript SDK
hide_table_of_contents: true
description: Create a restoration footprint manually to restore archived data using the JavaScript SDK
---

## Overview

Restoring archived data in the Stellar Network involves creating a restoration footprint that reverts the state to a previous point in time.

### Understanding State Archival Functionality

The Stellar Network maintains a ledger that records all transactions and changes. To enable efficient recovery, Stellar uses a state archival mechanism:

- State Snapshots: Periodically, Stellar takes snapshots of the ledger state.
- Archival Nodes: These snapshots are stored in archival nodes, which can be accessed to restore the state.
- Restoration Footprint: This is a set of data that, when applied to the current ledger state, reverts it to the state at a specific snapshot.

### Code Walkthrough

We will use the `@stellar/stellar-sdk` package to create a restoration footprint.

Install the @stellar/stellar-sdk package:

```
npm install --save @stellar/stellar-sdk
```

Code

```javascript
const StellarSdk = require("@stellar/stellar-sdk");

// Set up the Stellar server
const server = new StellarSdk.Server("https://horizon.stellar.org");

// Define the account and ledger range
const accountId = "GXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"; // Replace with actual account ID
const startLedger = 12345678; // Replace with actual start ledger
const endLedger = 23456789; // Replace with actual end ledger

async function createRestorationFootprint(accountId, startLedger, endLedger) {
  let cursor = "";
  const footprint = new Set();

  while (true) {
    try {
      const txResponse = await server
        .transactions()
        .forAccount(accountId)
        .cursor(cursor)
        .limit(200)
        .order("asc")
        .call();

      if (txResponse.records.length === 0) break;

      for (const tx of txResponse.records) {
        if (tx.ledger > endLedger) return Array.from(footprint);
        if (tx.ledger >= startLedger) {
          footprint.add(tx.id);

          const operations = await tx.operations();
          for (const op of operations.records) {
            footprint.add(op.id);
          }
        }
      }

      cursor = txResponse.records[txResponse.records.length - 1].paging_token;
    } catch (error) {
      console.error("Error fetching transactions:", error);
      throw error;
    }
  }

  return Array.from(footprint);
}

async function main() {
  try {
    console.log("Starting restoration footprint creation...");
    const footprint = await createRestorationFootprint(
      accountId,
      startLedger,
      endLedger,
    );
    console.log("Restoration Footprint:", footprint);
    console.log("Total items in footprint:", footprint.length);
  } catch (error) {
    console.error("Error in main function:", error);
  }
}

main();
```

### Detailed Explanation

1. Set Up the Stellar Server: The code initializes a connection to the Stellar Horizon server using the stellar-sdk library.

2. Define the Account and Ledger Range: The account ID and the range of ledgers (start and end) to restore are specified. This range defines the period during which the account's state will be analyzed.

3. Create Restoration Footprint:

- A cursor is initialized to keep track of the position in the transaction history.
- A set footprint is used to store unique transaction and operation IDs.
- The code enters a loop to fetch transactions for the specified account using the transactions endpoint.
- For each transaction, it checks if the transaction's ledger falls within the specified range.
- If the transaction's ledger is within the range, it adds the transaction ID to the footprint and fetches all operations associated with the transaction, adding their IDs to the footprint as well.
- The cursor is updated to the paging token of the last transaction to fetch the next set of transactions in the next iteration.
- The loop continues until there are no more transactions to fetch.

4. `main()`: The main function calls the `createRestorationFootprint` function, passing the account ID and ledger range. It then logs the resulting footprint and the total number of items in the footprint.

### Conclusion

This method records all important account changes within a set time frame. It tracks every transaction and operation, giving a full picture of the account's history. By catching all updates and connections, it provides a strong base for rebuilding the account's state on the Stellar network. This detailed record helps ensure a complete and accurate restoration.
